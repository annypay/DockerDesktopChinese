import type { v1 } from '@docker/extension-api-client-types';

export function wrapExecResult(rawRes: v1.RawExecResult): v1.ExecResult {
  const splitLines = () => rawRes.stdout.trim().split('\n');
  const res: v1.ExecResult = {
    ...rawRes,
    lines: splitLines,
    parseJsonLines: () => JSON.parse(`[${splitLines().join(',')}]`),
    parseJsonObject: () => JSON.parse(rawRes.stdout),
  };

  if (res.code && res.code !== 0) {
    throw res;
  }
  return res;
}
