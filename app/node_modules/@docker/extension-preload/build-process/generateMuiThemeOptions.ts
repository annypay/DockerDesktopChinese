// runs on Node, generates a JSON file with MUI theme options

import * as fs from 'node:fs/promises';
import * as path from 'node:path';
import { isPlainObject } from 'lodash';

import { extensionThemes } from '@docker/desktop-theme';

async function generateMuiThemeOptions() {
  assertSerializable(extensionThemes);

  await fs.writeFile(
    path.join(__dirname, '../src/mui-theme.json'),
    JSON.stringify(extensionThemes, null, '  '),
  );
}

generateMuiThemeOptions();

function assertSerializable(
  value: any,
  propertyPath: string[] = ['root'],
): void {
  if (
    typeof value === 'undefined' ||
    typeof value === 'string' ||
    typeof value === 'boolean' ||
    typeof value === 'number'
  ) {
    return;
  }

  if (Array.isArray(value)) {
    value.forEach((v, i) => {
      assertSerializable(v[i], [...propertyPath, `[${i}]`]);
    });
    return;
  }

  if (isPlainObject(value)) {
    for (var [k, v] of Object.entries(value)) {
      assertSerializable(v, [...propertyPath, `.${k}`]);
    }
    return;
  }

  throw new Error('Non-plain value at: ' + propertyPath.join(''));
}
